"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importWxssCssReg=exports.importWxssReg=void 0;const tslib_1=require("tslib"),fs_extra_1=(0,tslib_1.__importDefault)(require("fs-extra")),path_1=(0,tslib_1.__importDefault)(require("path")),error_1=require("../error"),less=()=>require("less");function default_1(e,s){return{name:"summer-less",resolveExt:{wxss:"less"},async load(r,t){var o;if(t.endsWith(".less")){let r=await fs_extra_1.default.readFile(t,"utf-8");const i=[];r=r.replace(exports.importWxssReg,(e,s,r)=>(i.push(r),e.replace(r,r+"?css")));try{const a=await require("less").render(r,{sourceMap:{outputSourceFiles:!0},filename:t,globalVars:null!==(o=null==s?void 0:s.globalVars)&&void 0!==o?o:{}}),l=a.css.replace(exports.importWxssCssReg,(e,s,r)=>{const t=r.slice(0,-4);return i.includes(t)?e.replace(r,t):e});if(a.imports.length)for(const e of a.imports)this.addWatchFile(e);let p=void 0;return a.map&&(p=JSON.parse(a.map),p.sources=p.sources.map(s=>path_1.default.posix.relative(e,s))),{sourceCode:l,inputMap:p}}catch(e){throw(0,error_1.makeSummerError)(e,error_1.SummerErrors.SUMMER_PLUGIN_CODE_ERR)}}}}}exports.importWxssReg=/(?:^|\s)?(?:@import)(?:\s*)?(["'])([^"']+.wxss)\1(?:\s*);/g,exports.importWxssCssReg=/(?:^|\s)?(?:@import)(?:\s*)?(["'])([^"']+.wxss\?css)\1(?:\s*);/g,exports.default=default_1;